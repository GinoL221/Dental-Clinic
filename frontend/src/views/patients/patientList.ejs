<!DOCTYPE html>
<html lang="es">
  <%- include('../partials/head') %>

  <body>
    <%- include('../partials/header') %>

    <main class="main-content">
      <div class="container mt-4">
        <div class="content-card">
          <div
            class="patient-list-header d-flex justify-content-between align-items-center mb-4"
          >
            <h1 class="patient-list-title">Lista de Pacientes</h1>
            <div class="d-flex gap-2">
              <input
                type="text"
                id="searchPatient"
                class="form-control"
                placeholder="Buscar paciente..."
                style="width: 250px"
              />
              <button id="clearSearch" class="btn btn-outline-secondary">
                <i class="bi bi-x-circle"></i>
              </button>
              <a href="/patients/add" class="btn btn-add-patient">
                <i class="bi bi-plus-circle me-2"></i>Agregar Paciente
              </a>
            </div>
          </div>

          <!-- Tabla de pacientes -->
          <div class="table-container">
            <table
              id="patientTable"
              class="table table-striped table-hover mb-0"
            >
              <thead class="table-dark">
                <tr>
                  <th>#</th>
                  <th>DNI</th>
                  <th>Nombre Completo</th>
                  <th>Email</th>
                  <th>Fecha Admisión</th>
                  <th class="text-center">Acciones</th>
                </tr>
              </thead>
              <tbody id="patientTableBody"></tbody>
            </table>
          </div>

          <!-- Mensaje cuando no hay datos -->
          <div
            id="noDataMessage"
            class="text-center py-5"
            style="display: none"
          >
            <i class="bi bi-inbox text-muted" style="font-size: 3rem"></i>
            <h5 class="text-muted mt-3">No hay pacientes registrados</h5>
            <p class="text-muted">Agrega el primer paciente para comenzar</p>
          </div>

          <!-- Loading spinner -->
          <div
            id="loadingSpinner"
            class="text-center py-5"
            style="display: none"
          >
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Cargando...</span>
            </div>
            <p class="text-muted mt-3">Cargando pacientes...</p>
          </div>
        </div>

        <!-- Mensajes de respuesta -->
        <div id="response" class="mt-3" style="display: none"></div>

        <!-- Formulario de actualización (se muestra cuando se edita) -->
        <div class="row mt-4">
          <div class="col-sm-6" id="div_patient_updating" style="display: none">
            <div class="edit-form-container">
              <div
                class="d-flex justify-content-between align-items-center mb-3"
              >
                <h4 class="edit-form-title">Modificar Paciente</h4>
                <button
                  id="btn-cancel-edit"
                  class="btn btn-outline-secondary btn-sm"
                >
                  <i class="bi bi-x"></i> Cancelar
                </button>
              </div>

              <form id="update_patient_form">
                <div class="form-group mb-3">
                  <label class="form-label">ID:</label>
                  <input
                    type="text"
                    class="form-control"
                    id="patient_id"
                    name="id"
                    readonly
                  />
                </div>

                <div class="form-group mb-3">
                  <label for="cardIdentity_edit" class="form-label">DNI:</label>
                  <input
                    type="number"
                    class="form-control"
                    id="cardIdentity_edit"
                    name="cardIdentity"
                    required
                  />
                </div>

                <div class="form-group mb-3">
                  <label for="firstName_edit" class="form-label">Nombre:</label>
                  <input
                    type="text"
                    class="form-control"
                    id="firstName_edit"
                    name="firstName"
                    required
                  />
                </div>

                <div class="form-group mb-3">
                  <label for="lastName_edit" class="form-label"
                    >Apellido:</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="lastName_edit"
                    name="lastName"
                    required
                  />
                </div>

                <div class="form-group mb-3">
                  <label for="email_edit" class="form-label">Email:</label>
                  <input
                    type="email"
                    class="form-control"
                    id="email_edit"
                    name="email"
                    required
                  />
                </div>

                <div class="form-group mb-3">
                  <label for="admissionDate_edit" class="form-label"
                    >Fecha de Admisión:</label
                  >
                  <input
                    type="date"
                    class="form-control"
                    id="admissionDate_edit"
                    name="admissionDate"
                    required
                  />
                </div>

                <div class="form-group mb-3">
                  <label for="address_edit" class="form-label"
                    >Dirección:</label
                  >
                  <textarea
                    class="form-control"
                    id="address_edit"
                    name="address"
                    rows="2"
                    placeholder="Dirección"
                  ></textarea>
                </div>

                <div class="d-flex gap-2">
                  <button type="submit" class="btn btn-primary">
                    <i class="bi bi-check-circle me-1"></i>Actualizar
                  </button>
                  <button
                    type="button"
                    id="btn-cancel-edit-2"
                    class="btn btn-secondary"
                  >
                    <i class="bi bi-x-circle me-1"></i>Cancelar
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </main>

    <%- include('../partials/footer') %>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- API Scripts en orden correcto -->
    <script type="module" src="/js/api/config.js"></script>
    <script type="module" src="/js/api/utils.js"></script>
    <script type="module" src="/js/api/auth-api.js"></script>
    <script type="module" src="/js/api/patient-api.js"></script>

    <!-- Controlador modular de lista -->
    <script type="module" src="/js/patient/patient-list-controller.js"></script>
  </body>
</html>
