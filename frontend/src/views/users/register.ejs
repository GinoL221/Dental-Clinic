<!DOCTYPE html>
<html lang="es">
  <%- include('../partials/head') %>

<body>
  <%- include('../partials/header') %>

  <main class="main-content auth-page">
    <div class="auth-container">
      <div class="auth-card">
        <div class="auth-header">
          <h2 class="auth-title">
            <i class="bi bi-person-plus-fill me-2"></i>Registro de Paciente
          </h2>
          <p class="auth-subtitle">Crea tu cuenta para solicitar citas en nuestra clínica</p>
        </div>

        <form id="registerForm" class="auth-form" method="POST" action="/users/register">
          <input type="hidden" id="role" name="role" value="PATIENT" />

          <!-- Datos Personales -->
          <div class="section-header mb-3">
            <h5 class="text-secondary border-bottom pb-2">
              <i class="bi bi-person me-2"></i>Datos Personales
            </h5>
          </div>

          <div class="row mb-3">
            <div class="col-md-6">
              <label for="firstName" class="form-label">
                <i class="bi bi-person me-1"></i>Nombre
              </label>
              <input type="text" class="form-control auth-input" id="firstName" name="firstName" placeholder="Ingresa tu nombre" required minlength="2" />
              <div class="invalid-feedback" id="firstName-error"></div>
            </div>
            <div class="col-md-6">
              <label for="lastName" class="form-label">
                <i class="bi bi-person me-1"></i>Apellido
              </label>
              <input type="text" class="form-control auth-input" id="lastName" name="lastName" placeholder="Ingresa tu apellido" required minlength="2" />
              <div class="invalid-feedback" id="lastName-error"></div>
            </div>
          </div>

          <!-- Dirección -->
          <div class="row mb-3">
            <div class="col-md-6">
              <label for="email" class="form-label">
                <i class="bi bi-envelope me-1"></i>Correo electrónico
              </label>
              <input type="email" class="form-control auth-input" id="email" name="email" placeholder="ejemplo@correo.com" required />
              <div class="invalid-feedback" id="email-error"></div>
            </div>
            <div class="col-md-6">
              <label for="cardIdentity" class="form-label">
                <i class="bi bi-card-text me-1"></i>DNI
              </label>
              <input type="text" class="form-control auth-input" id="cardIdentity" name="cardIdentity" placeholder="12345678" required />
              <div class="invalid-feedback" id="cardIdentity-error"></div>
            </div>
          </div>

          <div class="section-header mb-3">
            <h5 class="text-secondary border-bottom pb-2">
              <i class="bi bi-geo-alt me-2"></i>Dirección
            </h5>
          </div>

          <div class="mb-3">
            <label for="street" class="form-label">
              <i class="bi bi-road me-1"></i>Calle
            </label>
            <input type="text" class="form-control auth-input" id="street" name="street" placeholder="Av. Principal" required />
            <div class="invalid-feedback" id="street-error"></div>
          </div>

          <div class="row mb-3">
            <div class="col-md-3">
              <label for="number" class="form-label">
                <i class="bi bi-hash me-1"></i>Número
              </label>
              <input type="text" class="form-control auth-input" id="number" name="number" placeholder="123" pattern="[0-9A-Za-z\-\s]*" maxlength="10" title="Ingrese solo números, letras, guiones y espacios (ej: 123, 123-A, 123 B)" required />
              <div class="invalid-feedback" id="number-error"></div>
            </div>
            <div class="col-md-9">
              <label for="location" class="form-label">
                <i class="bi bi-building me-1"></i>Localidad
              </label>
              <input type="text" class="form-control auth-input" id="location" name="location" placeholder="Ciudad" required />
              <div class="invalid-feedback" id="location-error"></div>
            </div>
          </div>

          <div class="mb-3">
            <label for="province" class="form-label">
              <i class="bi bi-map me-1"></i>Provincia
            </label>
            <input type="text" class="form-control auth-input" id="province" name="province" placeholder="Provincia" required />
            <div class="invalid-feedback" id="province-error"></div>
          </div>

          <!-- Seguridad -->
          <div class="section-header mb-3">
            <h5 class="text-secondary border-bottom pb-2">
              <i class="bi bi-shield-lock me-2"></i>Seguridad
            </h5>
          </div>

          <div class="mb-3">
            <label for="password" class="form-label">
              <i class="bi bi-lock me-1"></i>Contraseña
            </label>
            <div class="position-relative">
              <input type="password" class="form-control password-input" id="password" name="password" placeholder="Mínimo 6 caracteres" required minlength="6" autocomplete="new-password" style="padding-right: 45px;" />
              <button type="button" class="btn-eye-toggle" onclick="togglePasswordVisibility('password', this)">
                <i class="bi bi-eye"></i>
              </button>
            </div>
            <div class="invalid-feedback" id="password-error"></div>
            <div class="password-strength-indicator"></div>
          </div>

          <div class="mb-4">
            <label for="confirmPassword" class="form-label">
              <i class="bi bi-lock-fill me-1"></i>Confirmar Contraseña
            </label>
            <input type="password" class="form-control auth-input" id="confirmPassword" name="confirmPassword" placeholder="Repite tu contraseña" required autocomplete="new-password" />
            <div class="invalid-feedback" id="confirmPassword-error"></div>
          </div>

          <button type="submit" class="btn auth-btn-primary w-100 mb-3">
            <i class="bi bi-person-check me-2"></i>Crear cuenta de paciente
          </button>

          <div class="auth-footer">
            <p>¿Ya tienes una cuenta?
              <a href="/users/login" class="auth-link">Inicia sesión aquí</a>
            </p>
            <div class="alert alert-info d-flex align-items-center mt-3" role="alert">
              <i class="bi bi-shield-check me-2"></i>
              <small>Tus datos están protegidos y solo serán utilizados para brindarte atención médica</small>
            </div>
          </div>
        </form>
      </div>
    </div>
  </main>

  <%- include('../partials/footer') %>

  <script type="module" src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script type="module" src="/js/api/config.js"></script>
  <script type="module" src="/js/api/utils.js"></script>
  <script type="module" src="/js/api/auth-api.js"></script>
  
  <!-- Validation Manager -->
  <script type="module" src="/js/auth/modules/validation-manager.js"></script>
  
  <!-- Register Controller con toda la lógica -->
  <script type="module" src="/js/auth/register-controller.js"></script>
</body>

</html>